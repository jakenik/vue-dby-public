webpackJsonp([14],{"9oJ1":function(s,t,a){s.exports=a("D88X")},D88X:function(s,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e={render:function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("section",[a("h2",[s._v("webSocket封装")]),s._v(" "),s._m(0),s._v(" "),a("h4",[s._v("connectSocket 开启一个连接")]),s._v(" "),a("demo-block",{staticClass:"demo-box",attrs:{jsfiddle:{html:'<template>\n  <base-button color="danger" @click="onClickConnectSocket">点击开启一个连接</base-button>\n</template>\n\n',script:"\nexport default {\n  methods: {\n    /**\n     * @param {*} { url, succ, fail }\n     * @param {是开发者服务器接口地址，必须是 wss 协议，且域名必须是后台配置的合法域名} { url }\n     * @param {否接口调用成功的回调函数} { succ }\n     * @param {否接口调用失败的回调函数} { fail }\n     * @returns\n     */\n    onClickConnectSocket () {\n      this.$webSocket.connectSocket ({ url: this.$env.apiH5Wss + this.$request.token, succ(){}, fail(){} })\n    },\n  }\n}\n",style:null}}},[a("div",{staticClass:"source",attrs:{slot:"source"},slot:"source"},[[a("base-button",{attrs:{color:"danger"},on:{click:s.onClickConnectSocket}},[s._v("点击开启一个连接")])]],2),s._v(" "),a("div",{staticClass:"highlight",attrs:{slot:"highlight"},slot:"highlight"},[a("pre",{pre:!0},[a("code",{pre:!0,attrs:{class:"hljs language-html"}},[a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("template")]),s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("base-button")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("color")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"danger"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("@click")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"onClickConnectSocket"')]),s._v(">")]),s._v("点击开启一个连接"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("base-button")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("template")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"javascript"}},[s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("default")]),s._v(" {\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("methods")]),s._v(": {\n    "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/**\n     * @param {*} { url, succ, fail }\n     * @param {是开发者服务器接口地址，必须是 wss 协议，且域名必须是后台配置的合法域名} { url }\n     * @param {否接口调用成功的回调函数} { succ }\n     * @param {否接口调用失败的回调函数} { fail }\n     * @returns\n     */")]),s._v("\n    onClickConnectSocket () {\n      "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$webSocket.connectSocket ({ "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("url")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$env.apiH5Wss + "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$request.token, succ(){}, fail(){} })\n    },\n  }\n}\n")]),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),s._v("\n")])])])]),s._v(" "),a("h4",[s._v("其他小方法不在赘述自行查看")]),s._v(" "),s._m(1),s._v(" "),a("h4",[s._v("websocketInit 初始化一个websocket")]),s._v(" "),a("p",[s._v("默认之存在一个websocket链接")]),s._v(" "),a("demo-block",{staticClass:"demo-box",attrs:{jsfiddle:{html:'<template>\n  <base-button color="danger" @click="onClickWebsocketInit">初始化一个websocket</base-button>\n</template>\n\n',script:"\nexport default {\n  methods: {\n    onClickWebsocketInit() {\n      this.$webSocket.websocketInit()\n    }\n  }\n}\n",style:null}}},[a("div",{staticClass:"source",attrs:{slot:"source"},slot:"source"},[[a("base-button",{attrs:{color:"danger"},on:{click:s.onClickWebsocketInit}},[s._v("初始化一个websocket")])]],2),s._v(" "),a("div",{staticClass:"highlight",attrs:{slot:"highlight"},slot:"highlight"},[a("pre",{pre:!0},[a("code",{pre:!0,attrs:{class:"hljs language-html"}},[a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("template")]),s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("base-button")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("color")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"danger"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("@click")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"onClickWebsocketInit"')]),s._v(">")]),s._v("初始化一个websocket"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("base-button")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("template")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"javascript"}},[s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("default")]),s._v(" {\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("methods")]),s._v(": {\n    onClickWebsocketInit() {\n      "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$webSocket.websocketInit()\n    }\n  }\n}\n")]),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),s._v("\n")])])])]),s._v(" "),a("h4",[s._v("这边这两个是添加和删除websocket监听回调 也就是消息接收后的回调")]),s._v(" "),s._m(2),s._v(" "),a("h4",[s._v("websocketExit 退出连接")]),s._v(" "),a("demo-block",{staticClass:"demo-box",attrs:{jsfiddle:{html:'<template>\n  <base-button color="danger" @click="onClickWebsocketExit">退出连接</base-button>\n</template>\n\n',script:"\nexport default {\n  methods: {\n    onClickWebsocketExit() {\n      this.$webSocket.websocketExit()\n    }\n  }\n}\n",style:null}}},[a("div",{staticClass:"source",attrs:{slot:"source"},slot:"source"},[[a("base-button",{attrs:{color:"danger"},on:{click:s.onClickWebsocketExit}},[s._v("退出连接")])]],2),s._v(" "),a("div",{staticClass:"highlight",attrs:{slot:"highlight"},slot:"highlight"},[a("pre",{pre:!0},[a("code",{pre:!0,attrs:{class:"hljs language-html"}},[a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("template")]),s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("base-button")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("color")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"danger"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("@click")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"onClickWebsocketExit"')]),s._v(">")]),s._v("退出连接"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("base-button")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("template")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"javascript"}},[s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("default")]),s._v(" {\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("methods")]),s._v(": {\n    onClickWebsocketExit() {\n      "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$webSocket.websocketExit()\n    }\n  }\n}\n")]),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),s._v("\n")])])])]),s._v(" "),a("h4",[s._v("websocketSendMessage 发送消息")]),s._v(" "),a("demo-block",{staticClass:"demo-box",attrs:{jsfiddle:{html:'<template>\n  <base-button color="danger" @click="onClickWebsocketSendMessage">发送消息</base-button>\n</template>\n\n',script:"\nexport default {\n  methods: {\n    onClickWebsocketSendMessage() {\n      //msgtype 发送消息类型 msgdata 发送内容 msgFrom 发送给什么平台\n      this.$webSocket.websocketSendMessage({msgtype:'xx', msgdata: {xx:'xx'}, msgFrom: 'miniprogram'})\n    }\n  }\n}\n",style:null}}},[a("div",{staticClass:"source",attrs:{slot:"source"},slot:"source"},[[a("base-button",{attrs:{color:"danger"},on:{click:s.onClickWebsocketSendMessage}},[s._v("发送消息")])]],2),s._v(" "),a("div",{staticClass:"highlight",attrs:{slot:"highlight"},slot:"highlight"},[a("pre",{pre:!0},[a("code",{pre:!0,attrs:{class:"hljs language-html"}},[a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("template")]),s._v(">")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("base-button")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("color")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"danger"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("@click")]),s._v("="),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v('"onClickWebsocketSendMessage"')]),s._v(">")]),s._v("发送消息"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("base-button")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("template")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("<"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"javascript"}},[s._v("\n"),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("default")]),s._v(" {\n  "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("methods")]),s._v(": {\n    onClickWebsocketSendMessage() {\n      "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("//msgtype 发送消息类型 msgdata 发送内容 msgFrom 发送给什么平台")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("this")]),s._v(".$webSocket.websocketSendMessage({"),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("msgtype")]),s._v(":"),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'xx'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("msgdata")]),s._v(": {"),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("xx")]),s._v(":"),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'xx'")]),s._v("}, "),a("span",{pre:!0,attrs:{class:"hljs-attr"}},[s._v("msgFrom")]),s._v(": "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'miniprogram'")]),s._v("})\n    }\n  }\n}\n")]),a("span",{pre:!0,attrs:{class:"hljs-tag"}},[s._v("</"),a("span",{pre:!0,attrs:{class:"hljs-name"}},[s._v("script")]),s._v(">")]),s._v("\n")])])])])],1)},staticRenderFns:[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("pre",{pre:!0},[a("code",{pre:!0,attrs:{class:"hljs language-javascript"}},[s._v("  "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("import")]),s._v(" { SocketApi } "),a("span",{pre:!0,attrs:{class:"hljs-keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"hljs-string"}},[s._v("'dby-base'")]),s._v("\n  Vue.use(SocketApi) "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 这边因为WebSocket是原生名称 怕起冲突改为SocketApi")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("// 访问 this.$webSocket")]),s._v("\n")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("pre",{pre:!0},[a("code",{pre:!0,attrs:{class:"hljs language-javascript"}},[a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/**\n * 通过 WebSocket 连接发送数据\n */")]),s._v("\nsendSocketMessage ({data}) {}\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/**\n * 关闭 WebSocket 连接。\n */")]),s._v("\ncloseSocket () {}\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/**\n * 监听WebSocket连接打开事件。\n */")]),s._v("\nonSocketOpen (callback) {}\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/**\n * 监听WebSocket接受到服务器的消息事件。\n */")]),s._v("\nonSocketMessage (callback) {}\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/**\n * 监听WebSocket关闭\n */")]),s._v("\nonSocketClose (callback) {}\n"),a("span",{pre:!0,attrs:{class:"hljs-comment"}},[s._v("/**\n * 监听WebSocket错误。\n */")]),s._v("\nonSocketError (callback) {}\n")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("pre",{pre:!0},[t("code",{pre:!0,attrs:{class:"hljs language-javascript"}},[this._v("  websocketRegisterHandler (msgtype, handler) { "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[this._v("//msgtype事件类型 handler事件接收回调")]),this._v("\n  }\n  websocketUnregisterHandler (msgtype) { "),t("span",{pre:!0,attrs:{class:"hljs-comment"}},[this._v("// 删除当前的所以回调监听")]),this._v("\n  }\n")])])}]},n=a("C7Lr")({methods:{onClickConnectSocket:function(){this.$webSocket.connectSocket({url:this.$env.apiH5Wss+this.$request.token,succ:function(){},fail:function(){}})},onClickWebsocketInit:function(){this.$webSocket.websocketInit()},onClickWebsocketExit:function(){this.$webSocket.websocketExit()},onClickWebsocketSendMessage:function(){this.$webSocket.websocketSendMessage({msgtype:"xx",msgdata:{xx:"xx"},msgFrom:"miniprogram"})}}},e,!1,null,null,null);t.default=n.exports}});
//# sourceMappingURL=14.05ae80fdc76e311dfe0f.js.map